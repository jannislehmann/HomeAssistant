---
octoprint:
  host: !secret octoprint_host
  api_key: !secret octoprint_key
  port: 443
  ssl: true
  number_of_tools: 1
  bed: true

camera:
  - platform: mjpeg
    name: Ender 3 V2
    still_image_url: !secret octoprint_snapshot
    mjpeg_url: !secret octoprint_webcam

input_boolean:
  ender3_v2_automatic_power_off:

template:
  - sensor:
    - name: "OctoPrint Time Elapsed"
      unit_of_measurement: 's'
      availability: >
        {{ not is_state('sensor.octoprint_start_time', 'unavailable') }}
      state: >
        {% set start = as_timestamp(states('sensor.octoprint_start_time')) %}
        {% if is_number(start) %}
          {{ (as_timestamp(now()) - start) | int }}
        {% else %}
          unknown
        {% endif %}
      attributes:
        start_time: "states('sensor.octoprint_start_time')"
    - name: "OctoPrint Time Remaining"
      unit_of_measurement: 's'
      availability: >
        {{ not is_state('sensor.octoprint_estimated_finish_time', 'unavailable') }}
      state: >
        {% set finish = as_timestamp(states('sensor.octoprint_estimated_finish_time')) %}
        {% if is_number(finish) %}
          {{ (finish - as_timestamp(now())) | int }}
        {% else %}
          unknown
        {% endif %}
      attributes:
        start_time: "states('sensor.octoprint_estimated_finish_time')"